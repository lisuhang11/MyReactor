# Reactor 模式多线程服务器

一个基于 Reactor 模式的多线程 TCP 服务器实现，支持并发处理多个客户端连接，具备消息接收、处理和回显功能。

## 项目介绍

本项目实现了一个基于 Reactor 模式的高性能多线程服务器，主要特点包括：

- 采用 I/O 多路复用（epoll）处理并发连接
- 多线程架构：主线程负责事件分发，接收线程处理新连接，工作线程处理客户端 I/O
- 支持客户端消息接收与带时间戳的回显
- 优雅的启动 / 关闭机制，支持资源自动释放

## 代码结构

```plaintext
.
├── myreactor.h      // Reactor服务器类声明
├── myreactor.cpp    // Reactor服务器类实现
├── server.cpp       // 服务器主程序（入口函数）
├── client.cpp       // 测试客户端程序
└── README.md        // 项目说明文档
```



## 核心组件

1. **Reactor 模式实现**：
   - 主线程（`main_loop`）：负责 epoll 事件监听与分发
   - 接收线程（`accept_thread_proc`）：处理新客户端连接
   - 工作线程（`worker_thread_proc`）：处理客户端 I/O 事件（5 个固定工作线程）
2. **线程同步机制**：
   - 条件变量（`std::condition_variable`）：用于线程间事件通知
   - 互斥锁（`std::mutex`）：保护共享资源访问
3. **事件处理**：
   - 基于 epoll 的 I/O 多路复用
   - 边缘触发（EPOLLET）模式提高性能
   - 非阻塞套接字处理

## 编译运行

### 环境要求

- Linux 系统（依赖 epoll 系统调用）
- g++ 编译器（支持 C++11 及以上标准）
- pthread 线程库

### 编译命令

```bash
# 编译服务器
g++ -std=c++11 myreactor.cpp server.cpp -o server -lpthread

# 编译客户端
g++ -std=c++11 client.cpp -o client -lpthread
```



### 运行步骤

1. 启动服务器：

   ```bash
   # 默认监听所有网络接口的8080端口
   ./server
   
   # 可选：指定IP和端口
   ./server 127.0.0.1 8888
   ```

   

2. 启动客户端（新终端）：

   ```bash
   # 连接本地服务器
   ./client 127.0.0.1 8080
   
   # 连接远程服务器
   ./client <服务器IP> <端口>
   ```

   

3. 使用说明：

   - 客户端连接后可输入文本消息
   - 服务器会添加时间戳并回显消息
   - 客户端输入`q`或`Q`退出
   - 服务器按`Ctrl+C`优雅关闭

## 功能测试

1. **基本消息收发**：
   - 客户端发送消息，服务器接收后添加时间戳回显
   - 示例：客户端发送`hello`，服务器回复`[2024-08-13 16:30:45]server reply: hello`
2. **并发连接测试**：
   - 启动多个客户端同时连接服务器
   - 验证服务器能否正确处理多个客户端的并发请求
3. **异常处理测试**：
   - 客户端异常断开，服务器能否检测并释放资源
   - 服务器优雅关闭后，客户端能否感知连接断开